<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sharkdle - Main Menu</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --deep-blue: #0a2463;
            --ocean-blue: #3e92cc;
            --wave-teal: #1b9aaa;
            --sea-green: #2a9d8f;
            --sand: #e9c46a;
            --coral: #f4a261;
            --shark-gray: #264653;
            --text-light: #E2E8F0;
            --text-muted: #94A3B8;
            --success: #2a9d8f;
            --danger: #e76f51;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--deep-blue);
            color: var(--text-light);
            min-height: 100vh;
            display: flex;
            flex-direction: row;
            background-image: 
                linear-gradient(135deg, rgba(10, 36, 99, 0.8) 0%, rgba(27, 154, 170, 0.5) 100%),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="rgba(255,255,255,0.1)" d="M0,192L48,197.3C96,203,192,213,288,229.3C384,245,480,267,576,250.7C672,235,768,181,864,181.3C960,181,1056,235,1152,234.7C1248,235,1344,181,1392,154.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
            background-size: cover;
            background-position: bottom;
            background-repeat: no-repeat;
        }

        .sidebar {
            width: 30%;
            background: rgba(30, 41, 59, 0.8);
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
        }

        .sidebar::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--ocean-blue), var(--wave-teal), var(--sea-green));
        }

        .sidebar .logo {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        .sidebar .logo h1 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--ocean-blue), var(--sea-green));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .sidebar .logo p {
            font-size: 1rem;
            color: var(--text-muted);
        }

        .sidebar .logo::after {
            content: "";
            display: block;
            width: 50px;
            height: 3px;
            background: linear-gradient(90deg, var(--ocean-blue), var(--wave-teal));
            margin: 15px auto;
            border-radius: 3px;
        }

        .sidebar .menu {
            margin-top: -10px;
            padding-top: 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .menu-btn {
            background: linear-gradient(135deg, var(--ocean-blue), var(--wave-teal));
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .menu-btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
            z-index: -1;
        }

        .menu-btn:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(62, 146, 204, 0.6);
        }

        .menu-btn:hover::before {
            left: 100%;
        }

        .menu-btn:active {
            transform: translateX(0);
            box-shadow: none;
        }

        .menu-btn i {
            font-size: 1.2rem;
        }

        .sidebar .footer {
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted);
            position: relative;
        }

        .sidebar .footer::before {
            content: "";
            display: block;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--wave-teal), transparent);
            margin: 20px 0;
        }

        .sidebar .footer a {
            color: var(--sea-green);
            text-decoration: none;
            margin: 0 5px;
            transition: color 0.3s ease;
        }

        .sidebar .footer a:hover {
            color: var(--ocean-blue);
            text-decoration: underline;
        }

        .main-content {
            width: 70%;
            padding: 40px;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .stats {
            background: rgba(51, 65, 85, 0.8);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(62, 146, 204, 0.2);
            backdrop-filter: blur(5px);
            position: relative;
            overflow: hidden;
        }

        .stats::after {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, var(--wave-teal) 0%, transparent 70%);
            opacity: 0.2;
            z-index: -1;
        }

        .stats i {
            font-size: 2rem;
            color: var(--sea-green);
            display: block;
            margin: 0 auto 10px auto;
        }

        .stats h2 {
            font-size: 1.5rem;
            color: var(--sea-green);
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            display: inline-block;
            margin-left: auto;
            margin-right: auto;
            padding-bottom: 5px;
        }

        .stats h2::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--sea-green), transparent);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(62, 146, 204, 0.2);
            transition: background 0.3s ease;
        }

        .stat-item:hover {
            background: rgba(62, 146, 204, 0.1);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .stat-value {
            font-weight: 600;
            font-size: 1rem;
            color: var(--sea-green);
        }

        .stat-bar-container {
            width: 100%;
            height: 25px;
            background: var(--shark-gray);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .stat-bar {
            height: 100%;
            display: flex;
            flex-direction: row;
            position: relative;
        }

        .stat-bar .win, .stat-bar .loss {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.85rem;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .stat-bar .win {
            background: var(--success);
        }

        .stat-bar .loss {
            background: var(--danger);
        }

        .recent-games {
            background: rgba(30, 41, 59, 0.9);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(62, 146, 204, 0.3);
            backdrop-filter: blur(6px);
            position: relative;
            overflow: hidden;
        }

        .recent-games h2 {
            font-size: 1.8rem;
            color: var(--sea-green);
            margin-bottom: 20px;
            text-align: center;
            position: relative;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .recent-games .no-games {
            text-align: center;
            color: var(--text-muted);
            font-size: 1rem;
            font-style: italic;
        }

        .recent-games .game-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(62, 146, 204, 0.2);
            transition: background 0.3s ease, transform 0.2s ease;
        }

        .recent-games .game-item:last-child {
            border-bottom: none;
        }

        .recent-games .game-item:hover {
            background: rgba(62, 146, 204, 0.15);
            transform: scale(1.02);
        }

        .recent-games .game-date {
            color: var(--text-muted);
            font-size: 0.95rem;
            font-style: italic;
        }

        .recent-games .game-result {
            font-weight: 700;
            font-size: 1.1rem;
            text-transform: uppercase;
        }

        .recent-games .game-result.win {
            color: var(--success);
        }

        .recent-games .game-result.loss {
            color: var(--danger);
        }

        .recent-games .game-guesses {
            color: var(--text-light);
            font-size: 0.95rem;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            .sidebar, .main-content {
                width: 100%;
            }
        }

        body.light-mode {
            background: #e0f7fa; /* Light ocean blue */
            color: #004d40; /* Deep teal for text */
        }

        body.light-mode .sidebar {
            background: #b2ebf2; /* Soft teal */
            color: #004d40; /* Deep teal for text */
        }

        body.light-mode .menu-btn {
            background: linear-gradient(135deg, #80deea, #4dd0e1); /* Ocean gradient */
            color: #004d40; /* Deep teal */
        }

        body.light-mode .menu-btn:hover {
            background: linear-gradient(135deg, #4dd0e1, #26c6da); /* Brighter ocean gradient */
        }

        body.light-mode .stats, body.light-mode .recent-games {
            background: #ffffff; /* White for contrast */
            color: #004d40; /* Deep teal */
            border: 1px solid #80deea; /* Ocean blue border */
        }

        body.light-mode .stats h2, body.light-mode .recent-games h2 {
            color: #00796b; /* Darker teal for headings */
        }

        body.light-mode .stat-bar .win {
            background: #00796b; /* Teal for wins */
        }

        body.light-mode .stat-bar .loss {
            background: #e57373; /* Coral red for losses */
        }

        body.light-mode .recent-games .game-item:hover {
            background: rgba(128, 222, 234, 0.2); /* Light ocean blue hover effect */
        }

        body.light-mode .sidebar .footer a {
            color: #00796b; /* Teal links */
        }

        body.light-mode .sidebar .footer a:hover {
            color: #004d40; /* Darker teal on hover */
        }

        /* Modal styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px) brightness(0.85) saturate(1.1);
            /* Add a soft vignette */
            box-shadow: 0 0 0 100vw rgba(10,20,40,0.18) inset;
        }

        .modal.hidden {
            display: none;
        }

        .modal-content {
            background: linear-gradient(135deg, #1b2a49 70%, #3e92cc44 100%);
            box-shadow: 0 32px 80px 0 rgba(30,41,59,0.90), 0 4px 24px 0 rgba(42,157,143,0.22);
            border-radius: 36px;
            border: 3px solid #3e92cc55;
            padding: 56px 64px 48px 64px;
            min-width: 540px;
            max-width: 720px;
            width: 90vw;
            margin: 0 16px;
            position: relative;
            overflow: visible;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: box-shadow 0.25s, border 0.22s;
        }

        @media (max-width: 900px) {
            .modal-content {
                min-width: 0;
                max-width: 99vw;
                width: 99vw;
                padding: 18px 2vw 18px 2vw;
            }
        }

        /* --- Mobile Options Modal Improvements --- */
        @media (max-width: 600px) {
            .modal-content {
                min-width: 0 !important;
                max-width: 100vw !important;
                width: 100vw !important;
                padding: 8px 0 8px 0 !important;
                border-radius: 16px !important;
            }
            .options-container {
                gap: 18px !important;
                padding: 0 2px 0 2px !important;
                max-height: 80vh !important;
            }
            .options-section {
                padding: 18px 8px 14px 8px !important;
                border-radius: 12px !important;
                margin-bottom: 12px !important;
            }
            .options-section h3 {
                font-size: 1.05rem !important;
                padding-bottom: 6px !important;
            }
            .option-btn, .close-btn {
                font-size: 1rem !important;
                padding: 12px 0 !important;
                width: 100% !important;
                min-width: 0 !important;
                border-radius: 10px !important;
            }
            .options-tab-btn {
                font-size: 1rem !important;
                padding: 10px 10px !important;
                border-radius: 12px 12px 0 0 !important;
            }
            #profile-pic-preview {
                width: 60px !important;
                height: 60px !important;
            }
            #profile-pic-selector {
                gap: 8px !important;
            }
            .profile-pic-option {
                width: 40px !important;
                height: 40px !important;
            }
            input[type="email"], input[type="password"], input[type="text"] {
                font-size: 1em !important;
                padding: 8px 8px !important;
            }
            .slider-container label {
                font-size: 0.95em !important;
            }
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 36px;
            padding: 0 2px 0 2px;
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 8px;
            width: 100%;
        }

        .options-tabs {
            display: flex;
            gap: 18px;
            margin-bottom: 36px;
            width: 100%;
            justify-content: cent\er;
            background: linear-gradient(90deg, #18304a 60%, #1b9aaa22 100%);
            border-radius: 20px 20px 0 0;
            box-shadow: 0 4px 18px rgba(30,41,59,0.15);
            border-bottom: 2.5px solid #3e92cc44;
            padding: 6px 0 0 0;
            margin-bottom: 32px;
        }

        .options-tab-btn {
            padding: 16px 48px;
            font-size: 1.22rem;
            font-weight: 700;
            border: none;
            border-radius: 20px 20px 0 0;
            background: rgba(51,65,85,0.88);
            color: #b3e5fc;
            border: none;
            margin-bottom: -2px;
            box-shadow: 0 2px 8px rgba(30,41,59,0.10);
            transition: background 0.22s, color 0.22s, box-shadow 0.18s, transform 0.18s;
        }

        .options-tab-btn.active {
            background: linear-gradient(135deg,#3e92cc 70%,#1b9aaa 100%);
            color: #fff;
            box-shadow: 0 6px 24px rgba(62,146,204,0.25);
            z-index: 2;
            transform: scale(1.08);
        }

        .options-tab-btn:hover {
            background: linear-gradient(135deg,#1b9aaa,#3e92cc 80%);
            color: #fff;
            transform: scale(1.06);
        }

        .options-section {
            margin-bottom: 0;
            padding: 38px 36px 28px 36px;
            border: 2px solid #3e92cc33;
            background: linear-gradient(120deg, rgba(51,65,85,0.99) 70%, rgba(42,157,143,0.18) 100%);
            box-shadow: 0 8px 28px rgba(62,146,204,0.18);
            border-radius: 22px;
            transition: box-shadow 0.22s, background 0.22s, border 0.18s;
        }

        .options-section:not(:last-child) {
            box-shadow: 0 6px 22px rgba(62,146,204,0.15), 0 1.5px 0 0 rgba(42,157,143,0.13);
            margin-bottom: 24px;
        }

        .options-section h3 {
            font-size: 1.35rem;
            color: var(--sea-green);
            margin-bottom: 18px;
            text-align: left;
            border-bottom: 2px solid rgba(42,157,143,0.22);
            padding-bottom: 10px;
            letter-spacing: 0.7px;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(30,41,59,0.10);
        }

        .option-btn {
            background: linear-gradient(135deg, var(--ocean-blue), var(--wave-teal));
            color: white;
            border: none;
            border-radius: 14px;
            padding: 16px 32px;
            font-size: 1.18rem;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.22s, transform 0.18s, box-shadow 0.18s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 6px 24px rgba(62,146,204,0.16);
        }

        .option-btn:hover {
            background: linear-gradient(135deg, var(--wave-teal), var(--sea-green));
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 12px 40px rgba(42,157,143,0.28);
        }

        .option-btn:active {
            transform: scale(0.98);
            box-shadow: none;
        }

        .close-btn {
            background: linear-gradient(90deg, #e76f51, #f4a261);
            color: #fff;
            font-weight: 800;
            margin-top: 18px;
            border-radius: 14px;
            box-shadow: 0 4px 18px rgba(231,111,81,0.18);
            position: absolute;
            right: 40px;
            top: 40px;
            padding: 14px 32px;
            min-width: 0;
            font-size: 1.18rem;
            border: none;
            z-index: 10;
            transition: background 0.18s, box-shadow 0.18s, transform 0.18s;
        }

        .close-btn i {
            margin-right: 8px;
        }

        .close-btn:hover {
            background: linear-gradient(90deg, #d9534f, #f4a261);
            box-shadow: 0 10px 32px rgba(231,111,81,0.28);
            transform: scale(1.06);
        }

        .close-btn:active {
            transform: scale(0.98);
            box-shadow: none;
        }

        /* Profile picture options */
        .profile-pic-option {
            box-shadow: 0 2px 8px rgba(30,41,59,0.10);
            border: 3px solid #3e92cc;
            transition: border 0.18s, box-shadow 0.18s, transform 0.18s;
            cursor: pointer;
            border-radius: 50%;
            width: 60px;
            height: 60px;
        }

        .profile-pic-option.selected {
            border: 4px solid #f4a261 !important;
            box-shadow: 0 10px 32px rgba(244,162,97,0.28);
            transform: scale(1.12);
        }

        .profile-pic-option:hover {
            border: 4px solid #f4a261 !important;
            box-shadow: 0 8px 28px rgba(244,162,97,0.22);
            transform: scale(1.09);
        }

        #profile-pic-preview {
            box-shadow: 0 4px 16px rgba(62,146,204,0.18);
            border: 4px solid #2a9d8f;
            width: 90px !important;
            height: 90px !important;
            border-radius: 50%;
        }

        /* Divider between tabs */
        .options-tabs::after {
            content: "";
            display: block;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #3e92cc33, transparent);
            margin-top: 2px;
        }

        /* Responsive tweaks */
        @media (max-width: 900px) {
            .modal-content {
                min-width: 0;
                max-width: 99vw;
                width: 99vw;
                padding: 18px 2vw 18px 2vw;
            }
        }

        @media (max-width: 600px) {
            .close-btn {
                position: static !important;
                width: 100% !important;
                margin: 18px 0 0 0 !important;
                right: auto !important;
                top: auto !important;
                display: block !important;
                z-index: 1 !important;
            }
            .modal-content {
                padding-bottom: 0 !important;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <h1>Sharkdle</h1>
            <p>Dive into the shark guessing game!</p>
        </div>
        <div class="menu">
            <button class="menu-btn" onclick="navigateTo('daily.html')">
                <i class="fas fa-calendar-day"></i> Daily Challenge
            </button>
            <button class="menu-btn" onclick="navigateTo('infinite.html')">
                <i class="fas fa-infinity"></i> Infinite Mode
            </button>
            <button class="menu-btn" onclick="navigateTo('how-to-play.html')">
                <i class="fas fa-question-circle"></i> How to Play
            </button>
            <button class="menu-btn" onclick="navigateTo('library.html')">
                <i class="fas fa-fish"></i> Sharkdle Library
                <button class="menu-btn" onclick="navigateTo('leaderboards.html')">
                    <i class="fas fa-trophy"></i> Leaderboards
            </button>
            <button class="menu-btn" onclick="openOptionsMenu()">
                <i class="fas fa-cog"></i> Options
            </button>
        </div>
        <div class="footer">
            <p>Made with <i class="fas fa-heart" style="color: var(--danger);"></i> by the Sharkdle Team</p>
            <p>
                <a href="https://github.com/Noobler28/sharkdle" target="_blank">GitHub</a> |
                <a href="updates.html" id="update-log-link">UPDATE LOG</a> |
                <a href="https://discord.gg/CGUbaUS5" target="_blank">Discord</a>
            </p>
        </div>
    </div>
    <div class="main-content">
        <div class="event-banner" style="background: linear-gradient(90deg, var(--ocean-blue), var(--wave-teal)); color: white; text-align: center; padding: 18px 0; font-size: 1.25rem; font-weight: 600; letter-spacing: 1px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(30,41,59,0.15);">
            <span id="event-banner-label" style="margin-right: 10px;"></span>
            <span id="event-countdown-main">Loading...</span>
        </div>
        <div class="stats">
            <h2>Your Stats</h2>
            <div class="stat-item">
                <span class="stat-label">Games Played:</span>
                <span class="stat-value" id="games-played">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Wins:</span>
                <span class="stat-value" id="wins">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Losses:</span>
                <span class="stat-value" id="losses">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Average Guesses:</span>
                <span class="stat-value" id="average-guesses">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Current Streak:</span>
                <span class="stat-value" id="current-streak">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Highest Streak:</span>
                <span class="stat-value" id="highest-streak">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Best Game (Fewest Guesses):</span>
                <span class="stat-value" id="best-game">N/A</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Win/Loss Ratio:</span>
                <div class="stat-bar-container">
                    <div class="stat-bar" id="win-loss-bar"></div>
                </div>
            </div>
        </div>
        <div class="recent-games">
            <h2>Recent Games</h2>
            <div id="recent-games-list">
                <!-- Games will be dynamically added here -->
                <p class="no-games">No games played yet.</p>
            </div>
        </div>
    </div>

    <!-- Updated Options Modal -->
    <div id="options-modal" class="modal hidden">
        <div class="modal-content">
            <h2>Options</h2>
            <div class="options-tabs" style="display:flex;gap:18px;margin-bottom:36px;width:100%;justify-content:center;">
                <button class="options-tab-btn active" id="tab-btn-account" onclick="showOptionsTab('account')" style="padding:12px 36px;font-size:1.18rem;font-weight:700;border:none;border-radius:20px 20px 0 0;background:linear-gradient(135deg,#3e92cc 70%,#1b9aaa 100%);color:white;cursor:pointer;transition:background 0.2s;">Account</button>
                <button class="options-tab-btn" id="tab-btn-settings" onclick="showOptionsTab('settings')" style="padding:12px 36px;font-size:1.18rem;font-weight:700;border:none;border-radius:20px 20px 0 0;background:rgba(51,65,85,0.88);color:#b3e5fc;cursor:pointer;transition:background 0.2s;">Settings</button>
            </div>
            <div class="options-container">
                <!-- Account Tab Content -->
                <div class="options-tab-content" id="tab-content-account" style="display:block;">
                    <div class="options-section">
                        <h3 style="display:flex;align-items:center;gap:8px;">Account
                        <button id="user-agreement-info-btn" type="button" title="View User Agreement" style="background:none;border:none;cursor:pointer;padding:0;margin-left:4px;color:#b3e5fc;font-size:1.15em;vertical-align:middle;">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </h3>
                        <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:8px;">
                            <input type="email" id="auth-email" placeholder="Email" style="padding:10px 12px;border-radius:7px;border:1.5px solid #3e92cc;width:100%;font-size:1.05rem;background:rgba(255,255,255,0.08);color:var(--text-light);transition:border 0.2s,box-shadow 0.2s;">
                            <div style="position:relative;">
                                <input type="password" id="auth-password" placeholder="Password" style="padding:10px 12px;border-radius:7px;border:1.5px solid #3e92cc;width:100%;font-size:1.05rem;background:rgba(255,255,255,0.08);color:var(--text-light);transition:border 0.2s,box-shadow 0.2s;">
                                <a href="#" id="forgot-password-link" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);font-size:0.97em;color:#f4a261;text-decoration:underline;cursor:pointer;">Forgot?</a>
                            </div>
                        </div>
                        <div style="display:flex;gap:10px;margin-bottom:8px;">
                            <button class="option-btn" style="padding:10px 16px;min-width:0;" onclick="signInUser()">Sign In</button>
                            <button class="option-btn" style="padding:10px 16px;min-width:0;" onclick="signUpUser()">Sign Up</button>
                            <button class="option-btn" id="signout-btn" style="padding:10px 16px;min-width:0;display:none;background:linear-gradient(90deg,#e76f51,#f4a261);" onclick="signOutUser()">Sign Out</button>
                        </div>
                        <div id="auth-msg" style="margin-top:4px;font-size:0.95em;min-height:1.2em;"></div>
                        <div id="user-agreement" style="margin-top:18px;font-size:0.97em;color:#b3e5fc;background:rgba(30,41,59,0.7);padding:12px 14px;border-radius:8px;text-align:left; display:none;">
                            <b>User Agreement:</b><br>
                            By creating an account, you agree that your email and game stats are stored securely using Google Firebase. Your email is only used for authentication and password recovery. Your stats are synced across devices. We do not share your data with third parties. You can delete your account by contacting support. By using this feature, you agree to these terms.
                            <br><br>
                            <a href="mailto:support@sharkdle.com" style="color:#f4a261;text-decoration:underline;font-weight:600;display:inline-block;margin-top:8px;">
                                <i class="fas fa-envelope"></i> Contact Support
                            </a>
                        </div>
                    </div>
                    <div class="options-section">
                        <h3>Leaderboard Display Name</h3>
                        <div style="margin-bottom:10px;">
                            <span style="color:#b3e5fc;">Current: </span>
                            <span id="current-leaderboard-name" style="font-weight:bold;"></span>
                        </div>
                        <div style="display:flex;align-items:center;gap:10px;width:100%;margin-bottom:8px;">
                            <button class="option-btn" style="padding:10px 16px;min-width:0;" onclick="updateLeaderboardName()">
                                <i class="fas fa-user-edit"></i>
                            </button>
                            <input type="text" id="leaderboard-name-input" maxlength="16" placeholder="Enter new display name" style="padding:10px 12px;border-radius:7px;border:1.5px solid #3e92cc;width:100%;font-size:1.05rem;background:rgba(255,255,255,0.08);color:var(--text-light);transition:border 0.2s,box-shadow 0.2s;">
                        </div>
                        <div id="leaderboard-name-msg" style="margin-top:8px;font-size:0.95em;"></div>
                    </div>
                    <div class="options-section">
                        <h3 style="display:flex;align-items:center;gap:8px;">Profile Picture</h3>
                        <div id="profile-pic-preview-container" style="display:flex;align-items:center;gap:18px;margin-bottom:10px;">
                            <img id="profile-pic-preview" src="images/pfp/shark1.png" alt="Profile Picture" style="width:90px;height:90px;border-radius:50%;border:4px solid #2a9d8f;background:#18304a;box-shadow:0 2px 8px rgba(30,41,59,0.18);object-fit:cover;transition:border 0.2s;">
                            <span id="profile-pic-label" style="color:#b3e5fc;font-size:1.08em;font-weight:600;">Your Profile Picture</span>
                        </div>
                        <div id="profile-pic-selector" style="display:flex;gap:16px;flex-wrap:wrap;justify-content:left;margin-bottom:8px;">
                            <img src="images/pfp/shark1.png" class="profile-pic-option" data-pic="shark1.png" alt="Shark 1" style="width:60px;height:60px;border-radius:50%;border:3px solid #3e92cc;cursor:pointer;object-fit:cover;transition:border 0.18s;">
                            <img src="images/pfp/shark2.png" class="profile-pic-option" data-pic="shark2.png" alt="Shark 2" style="width:60px;height:60px;border-radius:50%;border:3px solid #3e92cc;cursor:pointer;object-fit:cover;transition:border 0.18s;">
                            <img src="images/pfp/shark3.png" class="profile-pic-option" data-pic="shark3.png" alt="Shark 3" style="width:60px;height:60px;border-radius:50%;border:3px solid #3e92cc;cursor:pointer;object-fit:cover;transition:border 0.18s;">
                            <img src="images/pfp/shark4.png" class="profile-pic-option" data-pic="shark4.png" alt="Shark 4" style="width:60px;height:60px;border-radius:50%;border:3px solid #3e92cc;cursor:pointer;object-fit:cover;transition:border 0.18s;">
                            <img src="images/pfp/shark5.png" class="profile-pic-option" data-pic="shark5.png" alt="Shark 5" style="width:60px;height:60px;border-radius:50%;border:3px solid #3e92cc;cursor:pointer;object-fit:cover;transition:border 0.18s;">
                        </div>
                        <div id="profile-pic-msg" style="font-size:0.97em;min-height:1.2em;"></div>
                    </div>
                </div>
                <!-- Settings Tab Content -->
                <div class="options-tab-content" id="tab-content-settings" style="display:none;">
                    <div class="options-section">
                        <h3>Theme Settings</h3>
                        <button class="option-btn" onclick="toggleTheme()">
                            <i class="fas fa-adjust"></i> Toggle Theme
                        </button>
                    </div>
                    <div class="options-section">
                        <h3>Audio Settings</h3>
                        <div class="slider-container">
                            <label for="music-slider">Music Volume</label>
                            <input type="range" id="music-slider" min="0" max="100" value="50" oninput="updateMusicVolume(this.value)">
                        </div>
                        <div class="slider-container">
                            <label for="sound-slider">Sound Effects Volume</label>
                            <input type="range" id="sound-slider" min="0" max="100" value="50" oninput="updateSoundVolume(this.value)">
                        </div>
                    </div>
                    <div class="options-section">
                        <h3>Gameplay Settings</h3>
                        <button class="option-btn" onclick="resetStats()">
                            <i class="fas fa-redo"></i> Reset Stats
                        </button>
                    </div>
                    <div class="options-section">
                        <h3>Next Daily Challenge</h3>
                        <p id="daily-countdown">Loading...</p>
                    </div>
                </div>
                <!-- Feedback Button -->
                <button class="option-btn" style="background:linear-gradient(90deg,#3e92cc,#1b9aaa);margin-top:18px;" onclick="window.open('https://docs.google.com/forms/d/e/1FAIpQLSelQY3rofKg_QVNsVV6VJ5UKmsC05edZH3R7jRJ9QCGRZVOLw/viewform?usp=dialog','_blank')">
                    <i class="fas fa-bug"></i> Send Feedback / Report Bug
                </button>
                <!-- Close Button -->
                <button class="option-btn close-btn" onclick="closeOptionsMenu()">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <!-- Firebase Firestore (for leaderboard database) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <!-- Firebase Auth (for user authentication) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

    <script>
        // Firebase config and init
        const firebaseConfig = {
            apiKey: "AIzaSyAS9l8O1jRMafPt3r0lF6mqjr2-gl-EbZ0",
            authDomain: "sharkdle-leaderboard.firebaseapp.com",
            projectId: "sharkdle-leaderboard",
            storageBucket: "sharkdle-leaderboard.firebasestorage.app",
            messagingSenderId: "429123174628",
            appId: "1:429123174628:web:42ae9baed69c4b087c2cf1",
            measurementId: "G-HV5FFNKM5C"
        };
        if (window.firebase && (!firebase.apps || !firebase.apps.length)) {
            firebase.initializeApp(firebaseConfig);
        }

        function navigateTo(url) {
            window.location.href = url;
        }

        function toggleTheme() {
            const body = document.body;
            body.classList.toggle('light-mode');
            localStorage.setItem('theme', body.classList.contains('light-mode') ? 'light' : 'dark');
        }

        // Open the Options menu
        function openOptionsMenu() {
            document.getElementById('options-modal').classList.remove('hidden');
        }

        // Close the Options menu
        function closeOptionsMenu() {
            document.getElementById('options-modal').classList.add('hidden');
        }

        // JavaScript to dynamically update the Recent Games section
        const recentGamesList = document.getElementById('recent-games-list');

        function addRecentGame(date, result, guesses) {
            // Remove "No games played yet" message if it exists
            const noGamesMessage = document.querySelector('.no-games');
            if (noGamesMessage) {
                noGamesMessage.remove();
            }

            // Create a new game item
            const gameItem = document.createElement('div');
            gameItem.classList.add('game-item');

            // Add game details
            gameItem.innerHTML = `
                <span class="game-date">${date}</span>
                <span class="game-result ${result.toLowerCase()}">${result}</span>
                <span class="game-guesses">${guesses} Guesses</span>
            `;

            // Append the new game item to the list
            recentGamesList.appendChild(gameItem);
        }

        function loadRecentGames() {
            let recentGames;
            try {
                recentGames = JSON.parse(localStorage.getItem('recentGames') || '[]');
            } catch (error) {
                console.error('Error parsing recent games from localStorage:', error);
                recentGames = []; // Reset to an empty array if parsing fails
                localStorage.setItem('recentGames', JSON.stringify(recentGames));
            }

            const recentGamesList = document.getElementById('recent-games-list');

            if (recentGames.length === 0) {
                recentGamesList.innerHTML = '<p class="no-games">No games played yet.</p>';
                return;
            }

            recentGamesList.innerHTML = ''; // Clear existing content

            // Only display the 5 most recent games
            recentGames.slice(0, 5).forEach(game => {
                const gameItem = document.createElement('div');
                gameItem.classList.add('game-item');
                gameItem.innerHTML = `
                    <span class="game-date">${game.date} at ${game.time}</span>
                    <span class="game-result ${game.result.toLowerCase()}">${game.result}</span>
                    <span class="game-guesses">${game.guesses} Guesses</span>
                    <span class="game-shark">Shark: ${game.sharkName}</span>
                    <span class="game-mode" style="font-style:italic;color:#b3e5fc;">${game.mode ? game.mode : 'Unknown'}</span>
                `;
                recentGamesList.appendChild(gameItem);
            });
        }

        // Helper: Get current user
function getCurrentUser() {
    return firebase.auth().currentUser;
}

// Save stats to Firestore if signed in, else localStorage
function saveStats(stats) {
    const user = getCurrentUser();
    if (user) {
        const db = firebase.firestore();
        db.collection('userStats').doc(user.uid).set(stats, { merge: true });
    } else {
        // Save to localStorage as fallback
        Object.keys(stats).forEach(key => localStorage.setItem(key, stats[key]));
    }
}

// Load stats from Firestore if signed in, else localStorage
function loadStats(callback) {
    const user = getCurrentUser();
    if (user) {
        const db = firebase.firestore();
        db.collection('userStats').doc(user.uid).get().then(doc => {
            let stats = {};
            if (doc.exists) {
                stats = doc.data();
            }
            callback(stats);
        }).catch(() => {
            callback({});
        });
    } else {
        // Load from localStorage
        const stats = {
            gamesPlayed: parseInt(localStorage.getItem('gamesPlayed') || 0),
            wins: parseInt(localStorage.getItem('wins') || 0),
            losses: parseInt(localStorage.getItem('losses') || 0),
            currentStreak: parseInt(localStorage.getItem('currentStreak') || 0),
            highestStreak: parseInt(localStorage.getItem('highestStreak') || 0),
            averageGuesses: parseFloat(localStorage.getItem('averageGuesses') || 0),
            bestGame: localStorage.getItem('bestGame') || 'N/A',
            totalGuesses: parseInt(localStorage.getItem('totalGuesses') || 0)
        };
        callback(stats);
    }
}

// Update UI with stats
function updateStatsUI(stats) {
    const gamesPlayed = stats.gamesPlayed || 0;
    const wins = stats.wins || 0;
    const losses = stats.losses || 0;
    const currentStreak = stats.currentStreak || 0;
    const highestStreak = stats.highestStreak || 0;
    const averageGuesses = (stats.averageGuesses || 0).toFixed ? (stats.averageGuesses || 0).toFixed(2) : '0.00';
    const bestGame = stats.bestGame || 'N/A';
    const winPercentage = gamesPlayed > 0 ? ((wins / gamesPlayed) * 100).toFixed(2) : 0;
    const lossPercentage = gamesPlayed > 0 ? ((losses / gamesPlayed) * 100).toFixed(2) : 0;
    // ...existing code to update DOM elements...
    const gamesPlayedElement = document.getElementById('games-played');
    if (gamesPlayedElement) gamesPlayedElement.textContent = gamesPlayed;
    const winsElement = document.getElementById('wins');
    if (winsElement) winsElement.textContent = wins;
    const lossesElement = document.getElementById('losses');
    if (lossesElement) lossesElement.textContent = losses;
    const currentStreakElement = document.getElementById('current-streak');
    if (currentStreakElement) currentStreakElement.textContent = currentStreak;
    const highestStreakElement = document.getElementById('highest-streak');
    if (highestStreakElement) highestStreakElement.textContent = highestStreak;
    const averageGuessesElement = document.getElementById('average-guesses');
    if (averageGuessesElement) averageGuessesElement.textContent = averageGuesses;
    const bestGameElement = document.getElementById('best-game');
    if (bestGameElement) bestGameElement.textContent = bestGame;
    const winLossBar = document.getElementById('win-loss-bar');
    if (winLossBar) {
        winLossBar.innerHTML = `
            <div class="win" style="width: ${winPercentage}%; ${winPercentage > 10 ? '' : 'text-indent: -9999px;'}">
                ${winPercentage > 10 ? `${winPercentage}%` : ''}
            </div>
            <div class="loss" style="width: ${lossPercentage}%; ${lossPercentage > 10 ? '' : 'text-indent: -9999px;'}">
                ${lossPercentage > 10 ? `${lossPercentage}%` : ''}
            </div>
        `;
    }
}

// Call this to refresh stats UI
function refreshStats() {
    loadStats(updateStatsUI);
}

// Update stats and save
function updateStats(result, guesses) {
    loadStats(function(stats) {
        stats.gamesPlayed = (stats.gamesPlayed || 0) + 1;
        stats.wins = (stats.wins || 0) + (result === 'win' ? 1 : 0);
        stats.losses = (stats.losses || 0) + (result === 'loss' ? 1 : 0);
        stats.currentStreak = result === 'win' ? ((stats.currentStreak || 0) + 1) : 0;
        stats.highestStreak = Math.max(stats.currentStreak, stats.highestStreak || 0);
        stats.totalGuesses = (stats.totalGuesses || 0) + guesses;
        stats.averageGuesses = stats.totalGuesses / stats.gamesPlayed;
        const previousBestGame = parseInt(stats.bestGame) || Infinity;
        stats.bestGame = result === 'win' ? Math.min(previousBestGame, guesses) : previousBestGame;
        if (stats.bestGame === Infinity) stats.bestGame = 'N/A';
        saveStats(stats);
        updateStatsUI(stats);
    });
}

// On sign in, load stats from Firestore
firebase.auth().onAuthStateChanged(function(user) {
    if (user) {
        const db = firebase.firestore();
        const statsRef = db.collection('userStats').doc(user.uid);
        statsRef.get().then(doc => {
            // Get Firestore stats (if any)
            const cloudStats = doc.exists ? doc.data() : {};
            // Get local stats
            const localStats = {
                gamesPlayed: parseInt(localStorage.getItem('gamesPlayed') || 0),
                wins: parseInt(localStorage.getItem('wins') || 0),
                losses: parseInt(localStorage.getItem('losses') || 0),
                currentStreak: parseInt(localStorage.getItem('currentStreak') || 0),
                highestStreak: parseInt(localStorage.getItem('highestStreak') || 0),
                averageGuesses: parseFloat(localStorage.getItem('averageGuesses') || 0),
                bestGame: localStorage.getItem('bestGame') || 'N/A',
                totalGuesses: parseInt(localStorage.getItem('totalGuesses') || 0)
            };
            // Merge logic
            const merged = {
                gamesPlayed: (cloudStats.gamesPlayed || 0) + (localStats.gamesPlayed || 0),
                wins: (cloudStats.wins || 0) + (localStats.wins || 0),
                losses: (cloudStats.losses || 0) + (localStats.losses || 0),
                currentStreak: Math.max(cloudStats.currentStreak || 0, localStats.currentStreak || 0),
                highestStreak: Math.max(cloudStats.highestStreak || 0, localStats.highestStreak || 0),
                totalGuesses: (cloudStats.totalGuesses || 0) + (localStats.totalGuesses || 0),
                averageGuesses: 0, // will recalc below
                bestGame: (() => {
                    const c = cloudStats.bestGame === 'N/A' ? Infinity : parseInt(cloudStats.bestGame || Infinity);
                    const l = localStats.bestGame === 'N/A' ? Infinity : parseInt(localStats.bestGame || Infinity);
                    const best = Math.min(c, l);
                    return best === Infinity ? 'N/A' : best;
                })()
            };
            merged.averageGuesses = merged.gamesPlayed > 0 ? (merged.totalGuesses / merged.gamesPlayed) : 0;
            // Save merged stats to Firestore
            statsRef.set(merged, { merge: true }).then(() => {
                // Also update localStorage for consistency
                // Clear local stats to prevent double-counting on next login
                localStorage.setItem('gamesPlayed', 0);
                localStorage.setItem('wins', 0);
                localStorage.setItem('losses', 0);
                localStorage.setItem('currentStreak', 0);
                localStorage.setItem('highestStreak', 0);
                localStorage.setItem('totalGuesses', 0);
                localStorage.setItem('averageGuesses', 0);
                localStorage.setItem('bestGame', 'N/A');
                // After clearing, reload stats from Firestore and update UI
                statsRef.get().then(doc => {
                    let stats = {};
                    if (doc.exists) {
                        stats = doc.data();
                    }
                    updateStatsUI(stats);
                });
            });
        }).catch(() => {
            refreshStats();
        });
    } else {
        refreshStats();
    }
});

        function loadStats() {
            const gamesPlayed = parseInt(localStorage.getItem('gamesPlayed') || 0);
            const wins = parseInt(localStorage.getItem('wins') || 0);
            const losses = parseInt(localStorage.getItem('losses') || 0);
            const currentStreak = parseInt(localStorage.getItem('currentStreak') || 0);
            const highestStreak = parseInt(localStorage.getItem('highestStreak') || 0);
            const averageGuesses = parseFloat(localStorage.getItem('averageGuesses') || 0).toFixed(2);
            const bestGame = localStorage.getItem('bestGame') || 'N/A';

            const winPercentage = gamesPlayed > 0 ? ((wins / gamesPlayed) * 100).toFixed(2) : 0;
            const lossPercentage = gamesPlayed > 0 ? ((losses / gamesPlayed) * 100).toFixed(2) : 0;

            // Safely update DOM elements if they exist
            const gamesPlayedElement = document.getElementById('games-played');
            if (gamesPlayedElement) gamesPlayedElement.textContent = gamesPlayed;

            const winsElement = document.getElementById('wins');
            if (winsElement) winsElement.textContent = wins;

            const lossesElement = document.getElementById('losses');
            if (lossesElement) lossesElement.textContent = losses;

            const currentStreakElement = document.getElementById('current-streak');
            if (currentStreakElement) currentStreakElement.textContent = currentStreak;

            const highestStreakElement = document.getElementById('highest-streak');
            if (highestStreakElement) highestStreakElement.textContent = highestStreak;

            const averageGuessesElement = document.getElementById('average-guesses');
            if (averageGuessesElement) averageGuessesElement.textContent = averageGuesses;

            const bestGameElement = document.getElementById('best-game');
            if (bestGameElement) bestGameElement.textContent = bestGame;

            // Update win/loss bar if it exists
            const winLossBar = document.getElementById('win-loss-bar');
            if (winLossBar) {
                winLossBar.innerHTML = `
                    <div class="win" style="width: ${winPercentage}%; ${winPercentage > 10 ? '' : 'text-indent: -9999px;'}">
                        ${winPercentage > 10 ? `${winPercentage}%` : ''}
                    </div>
                    <div class="loss" style="width: ${lossPercentage}%; ${lossPercentage > 10 ? '' : 'text-indent: -9999px;'}">
                        ${lossPercentage > 10 ? `${lossPercentage}%` : ''}
                    </div>
                `;
            }
        }

        function updateStats(result, guesses) {
            const gamesPlayed = parseInt(localStorage.getItem('gamesPlayed') || 0) + 1;
            const wins = parseInt(localStorage.getItem('wins') || 0) + (result === 'win' ? 1 : 0);
            const losses = parseInt(localStorage.getItem('losses') || 0) + (result === 'loss' ? 1 : 0);
            const currentStreak = result === 'win' ? (parseInt(localStorage.getItem('currentStreak') || 0) + 1) : 0;
            const highestStreak = Math.max(currentStreak, parseInt(localStorage.getItem('highestStreak') || 0));
            const totalGuesses = parseInt(localStorage.getItem('totalGuesses') || 0) + guesses;
            const averageGuesses = totalGuesses / gamesPlayed;

            // Update the best game (fewest guesses)
            const previousBestGame = parseInt(localStorage.getItem('bestGame') || Infinity);
            const bestGame = result === 'win' ? Math.min(previousBestGame, guesses) : previousBestGame;

            // Save updated stats to localStorage
            localStorage.setItem('gamesPlayed', gamesPlayed);
            localStorage.setItem('wins', wins);
            localStorage.setItem('losses', losses);
            localStorage.setItem('currentStreak', currentStreak);
            localStorage.setItem('highestStreak', highestStreak);
            localStorage.setItem('totalGuesses', totalGuesses);
            localStorage.setItem('averageGuesses', averageGuesses);
            localStorage.setItem('bestGame', bestGame === Infinity ? 'N/A' : bestGame);

            // Reload stats on the page
            loadStats();
        }

        function endGame(result, guesses) {
            // Example: result = 'win' or 'loss', guesses = number of guesses
            updateStats(result, guesses);

            // Add the game to recent games
            const recentGames = JSON.parse(localStorage.getItem('recentGames') || '[]');
            const now = new Date();
            recentGames.unshift({
                date: now.toLocaleDateString(),
                time: now.toLocaleTimeString(),
                result: result,
                guesses: guesses,
                sharkName: 'Great White' // Example shark name
            });
            localStorage.setItem('recentGames', JSON.stringify(recentGames));

            // Reload recent games
            loadRecentGames();
        }

        function updateMusicVolume(value) {
            console.log(`Music Volume: ${value}`);
            localStorage.setItem('musicVolume', value);
            // Add logic to adjust music volume in your game
        }

        function updateSoundVolume(value) {
            console.log(`Sound Effects Volume: ${value}`);
            localStorage.setItem('soundVolume', value);
            // Add logic to adjust sound effects volume in your game
        }

        function toggleHints() {
            const hintsEnabled = localStorage.getItem('hintsEnabled') === 'true';
            localStorage.setItem('hintsEnabled', !hintsEnabled);
            alert(`Hints have been ${!hintsEnabled ? 'enabled' : 'disabled'}.`);
        }

        function updateDailyCountdown() {
            const now = new Date();
            const nextChallenge = new Date();
            nextChallenge.setHours(24, 0, 0, 0); // Midnight

            const timeLeft = nextChallenge - now;
            const hours = Math.floor((timeLeft / (1000 * 60 * 60)) % 24);
            const minutes = Math.floor((timeLeft / (1000 * 60)) % 60);
            const seconds = Math.floor((timeLeft / 1000) % 60);

            document.getElementById('daily-countdown').textContent = 
                `${hours}h ${minutes}m ${seconds}s`;

            setTimeout(updateDailyCountdown, 1000);
        }

        // Countdown for July 20th, 13:00 British time (Europe/London), but show local time for all users
        function updateEventCountdown() {
            // Target: 2025-07-20 13:00 in Europe/London (BST)
            // Calculate the UTC time for 13:00 BST (UTC+1) on July 20, 2025
            const eventDateLondon = new Date(Date.UTC(2025, 6, 20, 12, 0, 0)); // 13:00 BST = 12:00 UTC
            const now = new Date();
            const timeLeft = eventDateLondon.getTime() - now.getTime();

            let countdownText;
            if (timeLeft <= 0) {
                countdownText = 'Event has started!';
            } else {
                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft / (1000 * 60 * 60)) % 24);
                const minutes = Math.floor((timeLeft / (1000 * 60)) % 60);
                const seconds = Math.floor((timeLeft / 1000) % 60);
                countdownText = `${days}d ${hours}h ${minutes}m ${seconds}s`;
            }

            // Update both the main banner and the options modal if present
            const mainBanner = document.getElementById('event-countdown-main');
            if (mainBanner) mainBanner.textContent = countdownText;
            const modalBanner = document.getElementById('event-countdown');
            if (modalBanner) modalBanner.textContent = countdownText;

            if (timeLeft > 0) setTimeout(updateEventCountdown, 1000);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
            }
            loadStats();
            loadRecentGames();

            // Load saved slider values
            const savedMusicVolume = localStorage.getItem('musicVolume') || 50;
            const savedSoundVolume = localStorage.getItem('soundVolume') || 50;

            const musicSlider = document.getElementById('music-slider');
            if (musicSlider) musicSlider.value = savedMusicVolume;

            const soundSlider = document.getElementById('sound-slider');
            if (soundSlider) soundSlider.value = savedSoundVolume;

            // Set the event banner label to show the event's local time for the user
            const eventDateLondon = new Date(Date.UTC(2025, 6, 20, 12, 0, 0)); // 13:00 BST = 12:00 UTC
            const eventBannerLabel = document.getElementById('event-banner-label');
            if (eventBannerLabel) {
                eventBannerLabel.textContent = `UPDATE COUNTDOWN (${eventDateLondon.toLocaleString()}):`;
            }

            updateDailyCountdown();
            updateEventCountdown();
        });

        document.addEventListener('DOMContentLoaded', updateDailyCountdown);

        function resetStats() {
            if (confirm("Are you sure you want to reset your stats? This action cannot be undone.")) {
                localStorage.clear();
                loadStats();
                loadRecentGames();
                alert("Stats have been reset!");
            }
        }

        function updateLeaderboardName() {
            const input = document.getElementById('leaderboard-name-input');
            const msg = document.getElementById('leaderboard-name-msg');
            let username = input.value.trim();
            if (!username) {
                msg.textContent = 'Name cannot be empty.';
                msg.style.color = '#e76f51';
                return;
            }
            if (username.length < 3 || username.length > 16 || /[^a-zA-Z0-9_\-]/.test(username)) {
                msg.textContent = 'Name must be 3-16 letters/numbers, no spaces.';
                msg.style.color = '#e76f51';
                return;
            }
            const oldUsername = window.lastLeaderboardUsername || null;
            localStorage.setItem('sharkdle-username', username);
            document.getElementById('current-leaderboard-name').textContent = username;
            msg.textContent = 'Leaderboard name updated!';
            msg.style.color = '#2a9d8f';

            // Update Firestore leaderboard document if Firebase is available
            if (window.firebase && firebase.apps && firebase.apps.length && firebase.firestore) {
                try {
                    const db = firebase.firestore();
                    // Get the profilePic from localStorage or userStats
                    const profilePic = localStorage.getItem('profilePic') || 'shark1.png';
                    // If oldUsername exists and is different, update the document
                    if (oldUsername && oldUsername !== username) {
                        db.collection('leaderboard').doc(oldUsername).get().then(docSnap => {
                            if (docSnap.exists) {
                                const data = docSnap.data();
                                // Copy stats to new username, then delete old doc
                                db.collection('leaderboard').doc(username).set({
                                    ...data,
                                    username: username,
                                    profilePic: profilePic
                                }, { merge: true }).then(() => {
                                    db.collection('leaderboard').doc(oldUsername).delete();
                                });
                            } else {
                                // If no old doc, just update/create new one
                                db.collection('leaderboard').doc(username).set({ username: username, profilePic: profilePic }, { merge: true });
                            }
                        });
                    } else {
                        // No old username, just update/create new one
                        db.collection('leaderboard').doc(username).set({ username: username, profilePic: profilePic }, { merge: true });
                    }
                    window.lastLeaderboardUsername = username;
                } catch (e) {
                    msg.textContent = 'Name updated locally, but failed to update leaderboard online.';
                    msg.style.color = '#e76f51';
                }
            }
        }

        // Firebase Auth: Sign In
        function signInUser() {
            const email = document.getElementById('auth-email').value.trim();
            const password = document.getElementById('auth-password').value;
            const msg = document.getElementById('auth-msg');
            msg.textContent = '';
            if (!email || !password) {
                msg.textContent = 'Please enter both email and password.';
                msg.style.color = '#e76f51';
                return;
            }
            firebase.auth().signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    msg.textContent = 'Signed in successfully!';
                    msg.style.color = '#2a9d8f';
                    document.getElementById('signout-btn').style.display = 'inline-block'; // Show Sign Out button
                })
                .catch(error => {
                    msg.textContent = error.message;
                    msg.style.color = '#e76f51';
                });
        }

        // Firebase Auth: Sign Up
        function signUpUser() {
            const email = document.getElementById('auth-email').value.trim();
            const password = document.getElementById('auth-password').value;
            const msg = document.getElementById('auth-msg');
            msg.textContent = '';
            if (!email || !password) {
                msg.textContent = 'Please enter both email and password.';
                msg.style.color = '#e76f51';
                return;
            }
            firebase.auth().createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    msg.textContent = 'Account created! You are now signed in.';
                    msg.style.color = '#2a9d8f';
                    document.getElementById('signout-btn').style.display = 'inline-block'; // Show Sign Out button
                })
                .catch(error => {
                    msg.textContent = error.message;
                    msg.style.color = '#e76f51';
                });
        }

        // Firebase Auth: Sign Out
        function signOutUser() {
            firebase.auth().signOut().then(() => {
                document.getElementById('auth-msg').textContent = 'Signed out.';
                document.getElementById('auth-msg').style.color = '#e76f51';
                document.getElementById('signout-btn').style.display = 'none';
                // Optionally clear input fields
                document.getElementById('auth-email').value = '';
                document.getElementById('auth-password').value = '';
                refreshStats();
            });
        }

        // Show signed-in user email if available, and toggle sign out button
        firebase.auth().onAuthStateChanged(function(user) {
            const msg = document.getElementById('auth-msg');
            const signoutBtn = document.getElementById('signout-btn');
            if (user) {
                msg.textContent = `Signed in as: ${user.email}`;
                msg.style.color = '#2a9d8f';
                if (signoutBtn) signoutBtn.style.display = '';
            } else {
                if (signoutBtn) signoutBtn.style.display = 'none';
            }
        });

        // User Agreement toggle logic
        document.addEventListener('DOMContentLoaded', function() {
            var infoBtn = document.getElementById('user-agreement-info-btn');
            var agreement = document.getElementById('user-agreement');
            if (infoBtn && agreement) {
                infoBtn.addEventListener('click', function(e) {
                    agreement.style.display = (agreement.style.display === 'none' || agreement.style.display === '') ? 'block' : 'none';
                });
            }
        });

        // Firebase Auth: Forgot Password
        document.addEventListener('DOMContentLoaded', function() {
            var forgotLink = document.getElementById('forgot-password-link');
            if (forgotLink) {
                forgotLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    var email = document.getElementById('auth-email').value.trim();
                    var msg = document.getElementById('auth-msg');
                    if (!email) {
                        msg.textContent = 'Enter your email above to reset password.';
                        msg.style.color = '#e76f51';
                        return;
                    }
                    firebase.auth().sendPasswordResetEmail(email)
                        .then(function() {
                            msg.textContent = 'Password reset email sent! Check your inbox.';
                            msg.style.color = '#2a9d8f';
                        })
                        .catch(function(error) {
                            msg.textContent = error.message;
                            msg.style.color = '#e76f51';
                        });
                });
            }
        });

        // Tab switching logic
        function showOptionsTab(tab) {
            var accountBtn = document.getElementById('tab-btn-account');
            var settingsBtn = document.getElementById('tab-btn-settings');
            var accountContent = document.getElementById('tab-content-account');
            var settingsContent = document.getElementById('tab-content-settings');
            if (tab === 'account') {
                accountBtn.classList.add('active');
                settingsBtn.classList.remove('active');
                accountContent.style.display = 'block';
                settingsContent.style.display = 'none';
                accountBtn.style.background = 'linear-gradient(135deg,#3e92cc,#1b9aaa)';
                accountBtn.style.color = 'white';
                settingsBtn.style.background = 'rgba(51,65,85,0.88)';
                settingsBtn.style.color = '#b3e5fc';
            } else {
                accountBtn.classList.remove('active');
                settingsBtn.classList.add('active');
                accountContent.style.display = 'none';
                settingsContent.style.display = 'block';
                settingsBtn.style.background = 'linear-gradient(135deg,#3e92cc,#1b9aaa)';
                settingsBtn.style.color = 'white';
                accountBtn.style.background = 'rgba(51,65,85,0.88)';
                accountBtn.style.color = '#b3e5fc';
            }
        }

        // === Profile Picture Selection Logic ===
function setProfilePic(picture) {
    // Update preview
    const preview = document.getElementById('profile-pic-preview');
    if (preview) preview.src = `images/pfp/${picture}`;
    // Save to localStorage
    localStorage.setItem('profilePic', picture);
    // Save to Firestore if signed in
    const user = getCurrentUser && getCurrentUser();
    if (user && firebase && firebase.firestore) {
        // Update userStats
        firebase.firestore().collection('userStats').doc(user.uid).set({ profilePic: picture }, { merge: true });
        // Update leaderboard for current username with both username and profilePic
        const username = localStorage.getItem('sharkdle-username');
        if (username) {
            firebase.firestore().collection('leaderboard').doc(username).set({ username: username, profilePic: picture }, { merge: true });
        }
    }
       // Update selection highlight
    document.querySelectorAll('.profile-pic-option').forEach(img => {
        if (img.getAttribute('data-pic') === picture) {
            img.classList.add('selected');
        } else {
            img.classList.remove('selected');
        }
    });
    // Optional: show a message
    const msg = document.getElementById('profile-pic-msg');
    if (msg) {
        msg.textContent = 'Profile picture updated!';
        setTimeout(() => { msg.textContent = ''; }, 1500);
    }
}

function loadProfilePic() {
    // Try Firestore if signed in, else localStorage
    const user = getCurrentUser && getCurrentUser();
    if (user && firebase && firebase.firestore) {
        firebase.firestore().collection('userStats').doc(user.uid).get().then(doc => {
            let pic = 'shark1.png';
            if (doc.exists && doc.data().profilePic) {
                pic = doc.data().profilePic;
            } else {
                // fallback to localStorage
                pic = localStorage.getItem('profilePic') || 'shark1.png';
            }
            setProfilePic(pic);
        }).catch(() => {
            setProfilePic(localStorage.getItem('profilePic') || 'shark1.png');
        });
    } else {
        setProfilePic(localStorage.getItem('profilePic') || 'shark1.png');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Add click listeners to profile pic options
    document.querySelectorAll('.profile-pic-option').forEach(img => {
        img.addEventListener('click', function() {
            const pic = img.getAttribute('data-pic');
            setProfilePic(pic);
        });
    });
    loadProfilePic();
});
        // On sign in/out, reload profile pic
        firebase.auth().onAuthStateChanged(function() { loadProfilePic(); });
    </script>
</body>
</html>
